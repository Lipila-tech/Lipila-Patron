{% extends 'admin_layout.html' %}
{% load static %}
{% load custom_filters %}
{% block title %} Pending Withdrawals {% endblock %}

{% block section %}

{% include "_modal.html" %}
{% include "_confirmation.html" %}
<h2>Approve Withdrawal Requests</h2>
{% if pending_requests %}
<table class="table">
    <thead>
        <tr>
            <th>#</th>
            <th>Creator</th>
            <th>Amount Requested</th>
            <th>Account Balance</th>
            <th>Request Date</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for request in pending_requests %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ request.creator.user.username }}</td>
            <td>{{ request.amount }}</td>
            <td>{{ request.balance }}</td>
            <td>{{ request.request_date }}</td>
            <td>{{ request.status }}</td>
            <td>
                <!-- Approve request buttons -->
                <button class="approve-request btn btn-md btn-primary"
                    data-form-url="{% url 'approve_withdraw' request.pk %}">
                    <span class="fa fa-trash"></span>
                </button>
                <!-- Reject request buttons -->
                <button class="reject-request btn btn-md btn-primary"
                    data-form-url="{% url 'reject_withdraw' request.pk %}">
                    <span class="fa fa-trash"></span>
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<div id="loader" style="display: none;"></div>
{% else %}
<p>There are no pending withdrawal requests at this time.</p>
{% endif %}

{% endblock section %}
{% block extrascripts %}
<script type="text/javascript">
    $(function () {
        $('.approve-request, .reject-request').click(function () {
            const isApprove = $(this).hasClass('approve-request');
            const formUrl = $(this).data('form-url');

            $('#confirmationModal').modal('show');

            $('.approve-button').off('click').click(() => {
                // Handle approval logic
                $.ajax({
                    url: formUrl,
                    type: 'POST',
                    data: { is_approve: true }, // Add necessary data
                    success: function (response) {
                        // Handle success
                        $('#confirmationModal').modal('hide');
                        // Update the table or display a success message
                    },
                    error: function (error) {
                        // Handle error
                        console.error(error);
                    }
                });
            });

            $('.reject-button').off('click').click(() => {
                // Handle rejection logic
                $.ajax({
                    url: formUrl,
                    type: 'POST',
                    data: { is_approve: false }, // Add necessary data
                    success: function (response) {
                        // Handle success
                        $('#confirmationModal').modal('hide');
                        // Update the table or display a success message
                    },
                    error: function (error) {
                        // Handle error
                        console.error(error);
                    }
                });
            });
        });
    });
</script>
{%endblock extrascripts%}